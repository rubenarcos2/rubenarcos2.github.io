<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Python - Envío de emails mediante la api de Gmail con python</title>
  <meta name='description'
    content='Proyecto de webscraping: consiste en la captación de un listado con las ofertas de trabajo del portal *ticjob.es* para el lenguaje de programación Python y l...'>

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Dancing+Script%7CPT+Serif:400,400i,700%7CLato:400,700%7CRoboto:300,400"
    rel="stylesheet">

  <!-- Font Awesome v4.7.0 -->
  <link rel="stylesheet" href="/css/font-awesome.min.css">

  <!-- Normalize v7.0.0 -->
  <link rel="stylesheet" href="/css/normalize.css">

  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://rarcos.com/2022/03/18/Python-Gmail_api/">
  <link rel="alternate" type="application/rss+xml" title="Rubén Arcos" href="/%20/feed.xml">

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#faf5ee">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#faf5ee">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-status-bar-style" content="#faf5ee">
</head>
  
  
  
    
      <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VL018H86JE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-VL018H86JE');
</script> <!-- /Google Analytics -->
    

    <div class="full-page-container">
      <div class="overlay"></div>
      <header class="site-header clearfix">
  <div class="wrapper-content">

    <div class="navigation-wrap">
      <div class="nav-toggle-close"><i class="fa fa-times" aria-hidden="true"></i></div>

      <nav class="site-nav">
        
          
        
          
            
              <a href='/about/'>Sobre mí</a>
            
          
        
          
            
              <a href='/contacto/'>Contacto</a>
            
          
        
          
            
              <a href='/cookies/'>Cookies</a>
            
          
        
          
            
          
        
          
            
          
        
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
        <a href="https://linkedin.com/in/rubenarcos2"><i class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
        <a href="https://github.com/rubenarcos2"><i class="fa fa-github fa-2x" aria-hidden="true"></i></a>
      </nav>
      
    </div>

    <span class="search-toggle">
      <i class="fa fa-search" aria-hidden="true"></i>
    </span>
    
    <div class="nav-toggle"><i class="fa fa-bars" aria-hidden="true"></i></div>

    <div class="site-logo">
      <a href="/">Rubén Arcos</a>
    </div>
    
  </div>
</header> <!-- /.site-header -->

      <div class="search-box">
  <div class="wrapper-content">
    <form class="search-form">
      <label class="screen-reader-text" for="search-input">Buscar...</label>
      <input type="text" id="search-input" class="search-field" name="s" placeholder="Type to search...">
    </form>
    <div class="btn-close">
      <span class="bt-search-close">
        <i class="fa fa-times" aria-hidden="true"></i>
      </span>
    </div>
  </div>
  <ul id="results-container" class="search-results-list"></ul>  
</div> <!-- /.search-box -->

        <div class="post-header" style="background: url( /images/pages/getting-started-with-gmail-api-python.jpg)">
  <div class="post-header-info">
    <h1 class="post-title">Python - Envío de emails mediante la api de Gmail con python</h1>
    <div class="post-meta">
      <time datetime="2022-03-18T15:33:28+01:00">
         18/03/2022
      </time>
    </div>
  </div>
</div>

<div class="content-box">
  <article class="post">

    <div class="post-content">
      <h1 id="utilización-y-activación-de-la-api-de-gmail">Utilización y activación de la api de Gmail</h1>

<h2 id="google-api-console">Google API Console</h2>

<p>Lo primero que tenemos que hacer es crear un proyecto nuevo en <a href="https://console.cloud.google.com/apis/dashboard">Google Developers Console</a>. A continuación, haz clic en Seleccionar un proyecto y crea uno nuevo.</p>

<p><img src="https://lh4.googleusercontent.com/cQ3I0lmHvuA46MI7Btd3fL-4AVbcyFE6Z_a6OA3l3XrN6jsETLZNzt-uvrfu9wfiTN-BmL3EX2RLQapRZ1ILEmjfFB_BhcunrubAgBhRSJCmlXtg2Cv1toNKm7lznukYB0LgjYbP" alt="image1" /></p>

<p>Nombra tu nuevo proyecto y pulsa Crear en la parte inferior.</p>

<h2 id="habilita-gmail-api">Habilita Gmail API</h2>

<p>Una vez hecho esto, puedes pulsar la pestaña Biblioteca de la izquierda y encontrarte en la página de la Biblioteca API. Introduce “Gmail API” en la barra de búsqueda y haz clic en ella una vez encontrada. Ahora, tienes que habilitar la API para tu proyecto.</p>

<p><img src="https://lh6.googleusercontent.com/qRA82H-dl5bKqCzC8H_YpR8cDa23K85f6s5Q2piOw95VO62mqn_YfOkLFVaSD_p0qCVKTLGRLeFDMzU3Ad-Lb8Ou0Yde3efa7diXO5QDVC7IjCQcrbQh-H30xBVpy24KfrSZJ1Uc" alt="image2" /></p>

<p>*Ten en cuenta que tendrás que activarlo por separado para cada nuevo proyecto en el que trabajes. *</p>

<h2 id="paso-3-credenciales-y-autenticación-con-oauth-20">Paso 3: Credenciales y autenticación con OAuth 2.0</h2>

<p>Una vez activada la API, accederás a un bonito panel que dice: “Para utilizar esta API, puede que necesites credenciales”. Si haces clic en Crear credenciales, tendrás que pasar por una serie de preguntas para saber qué tipo de credenciales necesitas. Te aconsejamos que vayas por otro camino ya que ya sabemos lo que es: ID de cliente OAuth. Así pues, haz clic en la pestaña Credenciales de la izquierda, y luego elige OAuth client ID en la lista desplegable del botón Crear credenciales.</p>

<p><img src="https://lh6.googleusercontent.com/UwsT80hMiX5B1TjEg51gbqkkJ-iembuOfCu3cM9k1pdcv2mlleKht4k_FmeRFBwFApyuHkqb8Xgxut9dHybJAIQCtzfvul60Uh957dPXi3fRFrsU4ZjhTSZo_-8byEsxIy52jSRv" alt="image3" /></p>

<p>Verás el botón Configurar pantalla de consentimiento. Te llevará a una página con muchos campos. Sólo tienes que introducir el nombre de tu aplicación y especificar los dominios autorizados. Rellena otros campos si quieres.</p>

<p><img src="https://lh5.googleusercontent.com/WAhpqm_Hwa640iUPpKK7eWRPDIPf2FlpQ7Y5XT2uKa9UrfO-i868IpL-O4orLMXSMT6wRnubrYzyZD0LRUSjKt9xJDSOdZSrZmjBTuDKj3w9pGHG2U_m_afZ8RlN9R2SXmDHcXht" alt="image4" /></p>

<p>Haz clic en guardar y luego elige el tipo de tu aplicación (aplicación web, Android, Chrome App, iOS u otra). Después de eso, nombra tu ID de cliente OAuth. Además, introduce los orígenes de JavaScript y los dominios de redirección para utilizarlos con las solicitudes de un navegador o un servidor web, respectivamente. Haz clic en crear para finalizar. Eso es todo. Descarga un archivo JSON con tus credenciales - lo necesitarás más tarde.</p>

<h2 id="habilitación-de-la-api-de-gmail">Habilitación de la API de Gmail</h2>

<p>Para utilizar la API de Gmail, necesitamos un token para conectarnos a la API de Gmail, podemos obtener uno desde el panel de control de las API de Google.</p>

<p>Primero habilitamos la API de correo de Google, nos dirigimos al panel de control y utilizamos la barra de búsqueda para buscar la API de Gmail, hacemos clic en ella y la habilitamos:</p>

<p><img src="https://www.thepythoncode.com/media/articles/use-gmail-api-in-python/enable-gmail-api.png" alt="image5" /></p>

<p>A continuación, creamos un ID de cliente OAuth 2.0 mediante la creación de credenciales (dirigiéndose al botón Crear credenciales):</p>

<p><img src="https://www.thepythoncode.com/media/articles/use-gmail-api-in-python/create-oauth-client-id.png" alt="image6" /></p>

<p>Seleccione Desktop App como el tipo de aplicación y proceda, verá una ventana como esta:</p>

<p><img src="https://www.thepythoncode.com/media/articles/use-gmail-api-in-python/oauth-credentials.png" alt="image7" /></p>

<p>Descargamos nuestro archivo de credenciales y lo <strong>guardamos como</strong> <em>credentials.json</em> en el directorio actual:</p>

<p><img src="https://www.thepythoncode.com/media/articles/use-gmail-api-in-python/download-credentials.png" alt="image8" /></p>

<hr />

<p>Nota: Si es la primera vez que utilizas las API de Google, puede que tengas que crear simplemente una pantalla de consentimiento de OAuth y añadir tu correo electrónico como usuario de prueba.</p>

<h2 id="crear-pantalla-de-consentimiento">Crear pantalla de consentimiento</h2>

<p>Información detallada de cómo crearla <a href="https://docs.moodle.org/all/es/Servicio_OAuth_2_Google">aquí</a>.</p>

<p>Importante destacar que se marque para <em>uso interno</em> y que no se suba <em>logotipo</em>.</p>

<p>Es porque si no se activa un procedimiento de verificación humana, que retrasa la activación de ventana de consentimiento hasta que termine, y pueden ser días. Lo cual no necesitamos para nuestras pruebas y sería en caso de poner en producción la aplicación, para que así se muestre una ventana <em>formal</em> de aceptación de permisos con aspecto y auterización corporativo.</p>

<h1 id="creación-del-script-para-consumir-la-api-de-gmail-en-python">Creación del Script para consumir la API de Gmail en python</h1>

<h2 id="dependencias-necesarias">Dependencias necesarias</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>pip3 <span class="nb">install</span> <span class="nt">--upgrade</span> google-api-python-client google-auth-httplib2 google-auth-oauthlib</code></pre></figure>

<h2 id="código-de-consumo-de-la-api">Código de consumo de la api</h2>

<p>En la misma carpeta donde se encuentre este script, debe estar el fichero <em>credentials.json</em> que fue renombrado por el que nos descargamos de google con los credenciales de acceso de nuestra cuenta. También destacar que se creará de forma automática después del primer lanzamiento un fichero <em>tocken.picle</em> que no deberemos borrar.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Gmail API utils
</span>
<span class="kn">from</span> <span class="nn">googleapiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span>
<span class="kn">from</span> <span class="nn">google_auth_oauthlib.flow</span> <span class="kn">import</span> <span class="n">InstalledAppFlow</span>
<span class="kn">from</span> <span class="nn">google.auth.transport.requests</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="c1"># for encoding/decoding messages in base64
</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">urlsafe_b64decode</span><span class="p">,</span> <span class="n">urlsafe_b64encode</span>

<span class="c1"># for dealing with attachement MIME types
</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
<span class="kn">from</span> <span class="nn">email.mime.image</span> <span class="kn">import</span> <span class="n">MIMEImage</span>
<span class="kn">from</span> <span class="nn">email.mime.audio</span> <span class="kn">import</span> <span class="n">MIMEAudio</span>
<span class="kn">from</span> <span class="nn">email.mime.base</span> <span class="kn">import</span> <span class="n">MIMEBase</span>
<span class="kn">from</span> <span class="nn">mimetypes</span> <span class="kn">import</span> <span class="n">guess_type</span> <span class="k">as</span> <span class="n">guess_mime_type</span>

<span class="c1"># Request all access (permission to read/send/receive emails, manage the inbox, and more)
</span>
<span class="n">SCOPES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'https://mail.google.com/'</span><span class="p">]</span>
<span class="n">our_email</span> <span class="o">=</span> <span class="s">'email_envio@gmail.com'</span>

<span class="k">def</span> <span class="nf">gmail_authenticate</span><span class="p">():</span>
    <span class="n">creds</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># the file token.pickle stores the user's access and refresh tokens, and is
</span>    <span class="c1"># created automatically when the authorization flow completes for the first time
</span>    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">"token.pickle"</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"token.pickle"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="c1"># if there are no (valid) credentials availablle, let the user log in.
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">creds</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">creds</span><span class="p">.</span><span class="n">valid</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">creds</span> <span class="ow">and</span> <span class="n">creds</span><span class="p">.</span><span class="n">expired</span> <span class="ow">and</span> <span class="n">creds</span><span class="p">.</span><span class="n">refresh_token</span><span class="p">:</span>
            <span class="n">creds</span><span class="p">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">Request</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flow</span> <span class="o">=</span> <span class="n">InstalledAppFlow</span><span class="p">.</span><span class="n">from_client_secrets_file</span><span class="p">(</span><span class="s">'credentials.json'</span><span class="p">,</span> <span class="n">SCOPES</span><span class="p">)</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">flow</span><span class="p">.</span><span class="n">run_local_server</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># save the credentials for the next run
</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"token.pickle"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">pickle</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">creds</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">build</span><span class="p">(</span><span class="s">'gmail'</span><span class="p">,</span> <span class="s">'v1'</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>

<span class="c1"># get the Gmail API service
</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">gmail_authenticate</span><span class="p">()</span>

<span class="c1"># Adds the attachment with the given filename to the given message
</span>
<span class="k">def</span> <span class="nf">add_attachment</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">content_type</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">guess_mime_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="s">'application/octet-stream'</span>
    <span class="n">main_type</span><span class="p">,</span> <span class="n">sub_type</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">main_type</span> <span class="o">==</span> <span class="s">'text'</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">fp</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">decode</span><span class="p">(),</span> <span class="n">_subtype</span><span class="o">=</span><span class="n">sub_type</span><span class="p">)</span>
        <span class="n">fp</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">main_type</span> <span class="o">==</span> <span class="s">'image'</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEImage</span><span class="p">(</span><span class="n">fp</span><span class="p">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">_subtype</span><span class="o">=</span><span class="n">sub_type</span><span class="p">)</span>
        <span class="n">fp</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">main_type</span> <span class="o">==</span> <span class="s">'audio'</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEAudio</span><span class="p">(</span><span class="n">fp</span><span class="p">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">_subtype</span><span class="o">=</span><span class="n">sub_type</span><span class="p">)</span>
        <span class="n">fp</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="n">main_type</span><span class="p">,</span> <span class="n">sub_type</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">fp</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">fp</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">'Content-Disposition'</span><span class="p">,</span> <span class="s">'attachment'</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">message</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">build_message</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">attachments</span><span class="p">:</span> <span class="c1"># no attachments given
</span>        <span class="n">message</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="s">'html'</span><span class="p">)</span>
        <span class="n">message</span><span class="p">[</span><span class="s">'to'</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="n">message</span><span class="p">[</span><span class="s">'from'</span><span class="p">]</span> <span class="o">=</span> <span class="n">our_email</span>
        <span class="n">message</span><span class="p">[</span><span class="s">'subject'</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
        <span class="n">message</span><span class="p">[</span><span class="s">'to'</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="n">message</span><span class="p">[</span><span class="s">'from'</span><span class="p">]</span> <span class="o">=</span> <span class="n">our_email</span>
        <span class="n">message</span><span class="p">[</span><span class="s">'subject'</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">message</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="n">add_attachment</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">'raw'</span><span class="p">:</span> <span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()).</span><span class="n">decode</span><span class="p">()}</span>

<span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">attachments</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">return</span> <span class="n">service</span><span class="p">.</span><span class="n">users</span><span class="p">().</span><span class="n">messages</span><span class="p">().</span><span class="n">send</span><span class="p">(</span>
      <span class="n">userId</span><span class="o">=</span><span class="s">"me"</span><span class="p">,</span>
      <span class="n">body</span><span class="o">=</span><span class="n">build_message</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>
    <span class="p">).</span><span class="n">execute</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
    <span class="n">send_message</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code></pre></figure>

<h2 id="llamada-y-utilización-a-este-script">Llamada y utilización a este script</h2>

<p>El script anterior, lo denominto una dependencia y he externalizado su uso, por ello desde dónde tengamos los datos y queramos enviar el email deberemos poner:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">email_api_gmail</span> <span class="kn">import</span> <span class="n">send</span> <span class="c1">#Es el nombre que yo le he dado al script que consume la api de gmail.
</span>
<span class="c1">#### Envío de los datos por email
</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">=</span> <span class="s">"`&lt;html&gt;`"</span> <span class="o">+</span> <span class="n">df</span><span class="p">.</span><span class="n">to_html</span><span class="p">()</span> <span class="o">+</span> <span class="s">"`&lt;/html&gt;`"</span>
        <span class="n">send</span><span class="p">(</span><span class="s">"email_destinatario@dominio"</span><span class="p">,</span> <span class="s">"Encabezado del email"</span><span class="p">,</span> <span class="n">cuerpo_email</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Se ha el email correctamente."</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Ha habido un error en el envío del email:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></code></pre></figure>

<hr />
<p><strong>Fuentes:</strong></p>

<p><a href="https://mailtrap.io/blog/send-emails-with-gmail-api/#Python">https://mailtrap.io/blog/send-emails-with-gmail-api/#Python</a>
<a href="https://www.thepythoncode.com/article/use-gmail-api-in-python">https://www.thepythoncode.com/article/use-gmail-api-in-python</a>
<a href="https://developers.google.com/android-publisher/getting_started?hl=es-419">https://developers.google.com/android-publisher/getting_started?hl=es-419</a>
<a href="https://docs.moodle.org/all/es/Servicio_OAuth_2_Google">https://docs.moodle.org/all/es/Servicio_OAuth_2_Google</a></p>

    </div>

    <footer class="post-footer">
      <p>
      <h3>Content License</h3>

      <p><img src="/images/pages/88x311.png" /></p>

      <p>This web page, all content with proyects and source code, is licensed under Creative Commons:
        Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) <a
          href="https://creativecommons.org/licenses/by-nc-nd/4.0/">More info</a></p>

      <p>Esta página web y todo su contenido, incluido proyectos y código fuente, está licenciado bajo una licencia de
        Creative Commons: Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) <a
          href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.es">Más info</a></p>

      </p>

      <ul class="post-footer-list">
        <li class="post-footer-item">
          <a class="post-facebook"
            href="https://www.facebook.com/sharer/sharer.php?u=https://rarcos.com/2022/03/18/Python-Gmail_api/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Facebook" rel="nofollow"><i class="fa fa-facebook"
              aria-hidden="true"></i><span>Facebook</span></a>
        </li>

        <li class="post-footer-item">
          <a class="post-twitter"
            href="https://twitter.com/intent/tweet?text=Python%20-%20Env%C3%ADo%20de%20emails%20mediante%20la%20api%20de%20Gmail%20con%20python&url=https://rarcos.com/2022/03/18/Python-Gmail_api/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Twitter" rel="nofollow"><i class="fa fa-twitter"
              aria-hidden="true"></i><span>Twitter</span></a>
        </li>

        <li class="post-footer-item">
          <a href="http://pinterest.com/pin/create/button/?url=https://rarcos.com/2022/03/18/Python-Gmail_api/&amp;media=https://rarcos.com/images/pages/getting-started-with-gmail-api-python.jpg&amp;description=Python%20-%20Env%C3%ADo%20de%20emails%20mediante%20la%20api%20de%20Gmail%20con%20python"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            class="post-pinterest" title="Share on Pinterest" rel="nofollow"><i class="fa fa-pinterest"
              aria-hidden="true"></i><span>Pinterest</span></a>
        </li>

        <li class="post-footer-item">
          <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://rarcos.com/2022/03/18/Python-Gmail_api/&title=Python%20-%20Env%C3%ADo%20de%20emails%20mediante%20la%20api%20de%20Gmail%20con%20python"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            class="post-linkedin" title="Share on Linkedin" rel="nofollow"><i class="fa fa-linkedin"
              aria-hidden="true"></i><span>Linkedin</span></a>
        </li>
      </ul>
      
      <div class="post-tag">
        <span>Tags:</span>
        
        <a href="/tags#python" class="tag">python</a>
        
        <a href="/tags#gmail" class="tag">gmail</a>
        
        <a href="/tags#api" class="tag">api</a>
        
        <a href="/tags#webscraping" class="tag">webscraping</a>
        
      </div>
      
    </footer>

    
    <div class="post-author">
      
      <div class="post-author-image">
        <a style="background-image: url( /images/ruben.jpg)">
          <span class="screen-reader-text">Rubén Arcos Picture</span>
        </a>
      </div>
      <div class="post-author-info">
        <h4>Rubén Arcos</h4>
        <p class="post-author-bio">Desarrollador TI. <br>Tecnico superior en desarrollo de aplicaciones multiplataformas y<br>Técnico especialicialista en IA y Big data.</p>
        <div class="post-author-meta">
          
          <a href="https://twitter.com/rarcosdev" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
          
          
          <a href="https://linkedin.com/in/rubenarcos2" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
          
          
          <a href="https://github.com/rubenarcos2" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
          
          
          
          
          
          
          
          
          
        </div>
      </div>
      
    </div>

    <div class="page-navigation clearfix">
      
      <a class="prev-page" href="/2022/03/18/Python-Crontab/"><i class="fa fa-angle-left"
          aria-hidden="true"></i><span>Python - Programación de scripts mediante crontab en pyton</span></a>
      
      
      <a class="next-page" href="/2022/03/18/Python-Webscraping-1/"><span>Python - Webscraping I (BeautifulSoup)</span><i class="fa fa-angle-right"
          aria-hidden="true"></i></a>
      
    </div>

    
  </article> <!-- /.post -->

</div> <!-- /.content-box -->
<style>
    #cookie-notice {padding: 0.5rem 1rem; display: none; text-align: center; position: fixed; bottom: 0; width: calc(100% - 2rem); background: #222; color: rgba(255,255,255,0.8);}
    #cookie-notice a {display: inline-block; cursor: pointer; margin-left: 0.5rem;}
    @media (max-width: 767px) {
        #cookie-notice span {display: block; padding-top: 3px; margin-bottom: 1rem;}
        #cookie-notice a {position: relative; bottom: 4px;}
    }
</style>
<div id="cookie-notice"><span>Esta web utiliza cookies y scripts de terceros para mejorar la funcionalidad de este sitio web.</span>
    <a id="cookie-notice-accept" class="btn btn-primary btn-sm">Aceptar</a><a href="/cookies" class="btn btn-primary btn-sm">Más info</a></div>
<script>
    function createCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        createCookie(name,"",-1);
    }

    if(readCookie('cookie-notice-dismissed')=='true') {

    } else {
        document.getElementById('cookie-notice').style.display = 'block';
    }
    document.getElementById('cookie-notice-accept').addEventListener("click",function() {
        createCookie('cookie-notice-dismissed','true',31);
        document.getElementById('cookie-notice').style.display = 'none';
        location.reload();
    });

</script>

      <div class="top" title="Scroll To Top">
  <i class="fa fa-chevron-up" aria-hidden="true"></i>
</div> <!-- /.top -->
      <footer class="site-footer">

  <div class="footer-wrapper">

    <h2 class="footer-heading">Rubén Arcos</h2>

    <ul class="social-footer">
    
      <li><a href="https://twitter.com/rarcosdev" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
    
    
    
    
    <li><a href="https://linkedin.com/in/rubenarcos2" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
    
    
    <li><a href="https://github.com/rubenarcos2" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a></li>
    
    
    
    
    
    
    
    
    
    </ul>

    <div class="copyright">
      <p><a href="https://jekyllrb.com/">Proudly powered by Jekyll</a> | Theme: Lokmont by <a href="https://artemsheludko.github.io/">Artem Sheludko</a></p>
    </div>
  </div>

</footer> <!-- /.site-footer -->

    </div> <!-- /.full-page-container -->

    <script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery.viewportchecker.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script src="/js/simple-jekyll-search.min.js"></script>
<script src="/js/transition.js"></script>
<script src="/js/zoom.min.js"></script>
<script src="/js/main.js"></script>
    <style>
    #cookie-notice {padding: 0.5rem 1rem; display: none; text-align: center; position: fixed; bottom: 0; width: calc(100% - 2rem); background: #222; color: rgba(255,255,255,0.8);}
    #cookie-notice a {display: inline-block; cursor: pointer; margin-left: 0.5rem;}
    @media (max-width: 767px) {
        #cookie-notice span {display: block; padding-top: 3px; margin-bottom: 1rem;}
        #cookie-notice a {position: relative; bottom: 4px;}
    }
</style>
<div id="cookie-notice"><span>Esta web utiliza cookies y scripts de terceros para mejorar la funcionalidad de este sitio web.</span>
    <a id="cookie-notice-accept" class="btn btn-primary btn-sm">Aceptar</a><a href="/cookies" class="btn btn-primary btn-sm">Más info</a></div>
<script>
    function createCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        createCookie(name,"",-1);
    }

    if(readCookie('cookie-notice-dismissed')=='true') {

    } else {
        document.getElementById('cookie-notice').style.display = 'block';
    }
    document.getElementById('cookie-notice-accept').addEventListener("click",function() {
        createCookie('cookie-notice-dismissed','true',31);
        document.getElementById('cookie-notice').style.display = 'none';
        location.reload();
    });

</script>
  </body>

</html>
